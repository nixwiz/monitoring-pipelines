---
# Description
#   The Sensu Ansible Tower Handler is a Sensu Event Handler that is used to remediate
#   events by calling Ansible Tower Job Templates
#
# Instructions
#   1. Add "ansible-tower" to the "remediation" handler set.
#
#      To create the "remediation" handler set, please run:
#
#      $ sensuctl handler create remediation --type set --handlers ansible-tower
#
#      If you already have a handler set called "remediation", please run:
#
#      $ sensuctl edit handler remediation
#
#      NOTE: the sensuctl edit command will open your default editor; please
#      modify the "handlers" attribute by adding "ansible-tower".
#
#   2. Configure the following secrets using your preferred Sensu Go Secrets
#      provider:
#
#      - ansible_tower_host (e.g. "http://127.0.0.1:3000")
#      - ansible_tower_token (secret application token generated by Ansible Tower)
#
#      NOTE: example secret resources using the "env" provider are included in
#      this template; to add your secrets to the Sensu Backend, please modify
#      /etc/default/sensu-backend or /etc/sysconfig/sensu-backend and restart
#      the sensu-backend service.
#
#   3. More configuration options are available for this plugin; please see the
#      plugin documentation for more details.
#
# Check usage Note:
#  Checks that would like to make use of Ansible Tower, can make use of a specially 
#  defined annotation that encodes an array of job template request objects.
#  Each job template request consists of a job template name or id, 
#  inventory name or id, remediation matching conditions (occurences, severities), 
#  and an optional inventory limit ( default limit is event entity name).   
#
#  Handler cmdline arguments and envvars can influence behavior when requests are 
#  under specified, please review the documentation concerning handler arguments.
#
#  This template defaults to requiring fully specified job template requests in each 
#  check for correct operation.
#
# Documentation
#   - https://github.com/sensu/sensu-ansible-handler
#   - https://docs.sensu.io/sensu-go/latest/reference/secrets/
#
# Contributors
#   The following individuals have contributed to this configuration template:
#   - @jspaleta

type: Handler
api_version: core/v2
metadata:
  labels:
    sensu.io/managed_by: sensuctl
  name: ansible-tower
spec:
  command: sensu-ansible-handler --host ${ANSIBLE_HOST}
  runtime_assets:
  - sensu/sensu-ansible-handler:2.1.0
  secrets:
  - name: ANSIBLE_HOST
    secret: ansible_tower_host
  - name: ANSIBLE_TOKEN
    secret: ansible_tower_token
  timeout: 10
  type: pipe
---
type: Asset
api_version: core/v2
metadata:
  annotations:
    io.sensu.bonsai.api_url: https://bonsai.sensu.io/api/v1/assets/sensu/sensu-ansible-handler
    io.sensu.bonsai.message: This asset is for users with a valid Enterprise license
    io.sensu.bonsai.name: sensu-ansible-handler
    io.sensu.bonsai.namespace: sensu
    io.sensu.bonsai.tags: ""
    io.sensu.bonsai.tier: Enterprise
    io.sensu.bonsai.url: https://bonsai.sensu.io/assets/sensu/sensu-ansible-handler
    io.sensu.bonsai.version: 2.1.0
  labels:
    sensu.io/managed_by: sensuctl
  name: sensu/sensu-ansible-handler:2.1.0
spec:
  builds:
  - filters:
    - entity.system.os == 'linux'
    - entity.system.arch == 'armv7'
    headers: null
    sha512: ea1a82bcd7c60c3be9d9f81c0d837c54914a6782fd545ad5c7a1589e3c81f9a3eb2f926dccf9896e2615a5a91f5ff128ef739aadb374e3ea0e54b9e12d760348
    url: https://assets.bonsai.sensu.io//builds/sensu-ansible-handler_2.1.0_linux_armv7.tar.gz
  - filters:
    - entity.system.os == 'linux'
    - entity.system.arch == 'arm64'
    headers: null
    sha512: fc8e577a39f3b254b8fd38b5e997dccacaf4c75aa396f1e9d7b3e511da961dcca1180aaf089f29149fc33d2de68586be9f5bb005f0c859e3160685728f0a4372
    url: https://assets.bonsai.sensu.io//builds/sensu-ansible-handler_2.1.0_linux_arm64.tar.gz
  - filters:
    - entity.system.os == 'linux'
    - entity.system.arch == '386'
    headers: null
    sha512: 788959360e3aad513b1a469b9db4db87a0cd304f950d289c01fa62f976d5ecf97b8ff6695614d67ae74cb653c33632f97f4a9d13690c90292daea60f2c013e8c
    url: https://assets.bonsai.sensu.io//builds/sensu-ansible-handler_2.1.0_linux_386.tar.gz
  - filters:
    - entity.system.os == 'linux'
    - entity.system.arch == 'amd64'
    headers: null
    sha512: ba4f575f9160b084a51b70c60c73cdb145676a288a32c671f6eddf68b74f43ba7d887e8d4356059dec834e09d32cc05d044d09bb55e28030faecf01fdaf6c998
    url: https://assets.bonsai.sensu.io//builds/sensu-ansible-handler_2.1.0_linux_amd64.tar.gz
  filters: null
  headers: null

